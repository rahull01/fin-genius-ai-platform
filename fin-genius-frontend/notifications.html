<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FinGenius | Notifications</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body{margin:0;font-family:Poppins;background:#f4f6fb}
        nav{display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,#405DE6,#833AB4);color:#fff;padding:14px 30px}
        nav a{color:white;margin:0 10px;text-decoration:none;font-weight:500}
        .logo{font-size:22px;font-weight:700}
        .profile{position:relative;cursor:pointer}
        .profile img{width:36px;border-radius:50%}
        .menu{position:absolute;right:0;top:45px;background:white;color:black;border-radius:10px;width:200px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:none;z-index:10}
        .menu p{margin:10px;font-size:14px}
        .menu button{width:90%;margin:10px;border:none;padding:8px;background:#ef4444;color:white;border-radius:6px;cursor:pointer}
        .container{padding:30px;max-width:900px;margin:auto}
        h2{color:#333;margin-bottom:20px}
        .notif-card{background:white;padding:20px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,.05);margin-bottom:15px}
        .notif-card h4{margin:0;color:#4f46e5}
        .notif-card p{margin:5px 0;color:#555}
        .notif-card span{font-size:12px;color:#999}
        .toast{position:fixed;top:20px;right:20px;background:#16a34a;color:#fff;padding:12px 20px;border-radius:8px;box-shadow:0 5px 20px rgba(0,0,0,.2);z-index:999;display:none}
    </style>
</head>
<body>

<nav>
    <div class="logo">FinGenius</div>
    <div>
        <a href="dashboard.html">Dashboard</a>
        <a href="transactions.html">Transactions</a>
        <a href="ai-advisor.html">AI Advisor</a>
        <a href="notifications.html">Notifications</a>
    </div>
    <div class="profile" onclick="toggleMenu()">
        <img src="https://i.pravatar.cc/100">
        <div id="menu" class="menu">
            <p id="name"></p>
            <p id="email"></p>
            <button onclick="logout()">Logout</button>
        </div>
    </div>
</nav>

<div id="toast" class="toast">Loaded</div>

<div class="container">
    <h2>Your Notifications</h2>
    <div id="notifList">
        <p>Loading notifications...</p>
    </div>
</div>

<script>
    const API = "http://localhost:8086";
    const user = JSON.parse(localStorage.getItem("user"));
    if(!user) location.href="auth.html";

    document.getElementById("name").innerText = user.fullName;
    document.getElementById("email").innerText = user.email;

    function toggleMenu(){
      const m = document.getElementById("menu");
      m.style.display = m.style.display === "block" ? "none" : "block";
    }
    function logout(){
      localStorage.clear();
      location.href = "auth.html";
    }
    function showToast(msg, ok=true){
      const t = document.getElementById("toast");
      t.style.background = ok ? "#16a34a" : "#ef4444";
      t.innerText = msg;
      t.style.display = "block";
      setTimeout(()=> t.style.display="none", 3000);
    }

    function loadNotifications(){
      fetch(`${API}/api/notifications/user/${user.id}`)
        .then(r => r.json())
        .then(data => {
          const list = document.getElementById("notifList");
          if(!Array.isArray(data) || data.length === 0){
            list.innerHTML = "<p>No notifications yet</p>";
            return;
          }
          // newest first
          data.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
          list.innerHTML = data.map(n =>
            `<div class="notif-card">
              <h4>üîî Notification #${n.id}</h4>
              <p>${n.message}</p>
              <span>${new Date(n.createdAt).toLocaleString()}</span>
            </div>`
          ).join("");
          showToast("‚úÖ Notifications loaded");
        })
        .catch(()=> showToast("‚ùå Failed to load notifications", false));
    }

    loadNotifications();
</script>

</body>
</html>
